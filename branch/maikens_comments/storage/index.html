<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Persistent Storage &mdash; Container on HPC with Apptainer  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />

  
    <link rel="shortcut icon" href="../_static/coderefinery.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Container on HPC with Apptainer
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro_and_motivation/">Intro to containers (on HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics_running_containers/">Basics of running containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../container_images/">Intro to container images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building_images/">Building Apptainer images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binding_folders/">Binding folders into your container</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gpus/">Running containers that use GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services_apps/">Services and apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_tricks/">Tips, tricks and frequently asked questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../verify_installation/">Verify Apptainer Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first_build/">Building Your First Container</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Container on HPC with Apptainer</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Persistent Storage</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/ttt4hpc_containers/blob/main/ttt4hpc_containers/content/storage.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="persistent-storage">
<h1>Persistent Storage<a class="headerlink" href="#persistent-storage" title="Permalink to this heading"></a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand the importance of persistent storage in containerized environments.</p></li>
<li><p>Learn how to configure persistent storage for an Apptainer container to maintain data state between runs.</p></li>
<li><p>Develop the ability to effectively manage data persistence, enhancing the usability and flexibility of container deployments in HPC settings.</p></li>
</ul>
<p>This demo explains how to set up and use persistent storage with Apptainer containers. Persistent storage is crucial for applications that need to maintain data or state between runs, such as databases or applications that generate ongoing logs or results. This capability is essential for ensuring data is not lost when a container is stopped or restarted, which is especially important in research environments where data integrity and continuity are paramount.</p>
</div>
<div class="admonition-prerequisites prerequisites admonition" id="prerequisites-0">
<p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p>Access to an HPC system with Apptainer installed.</p></li>
<li><p>Basic knowledge of filesystems and permissions on Linux.</p></li>
</ul>
</div>
<p>Container technology typically encapsulates application environments and dependencies, but by default, any changes made inside the container can be lost when the container is stopped or destroyed. To prevent this, Apptainer allows you to bind host directories to the container, enabling the container to read from and write to persistent storage on the host system.</p>
<p>First, we will demonstrate creating a simple application that writes data to a file inside a container, then show how this data can be preserved using a host directory bound to the container.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a directory on the host to serve as persistent storage</span>
mkdir<span class="w"> </span>-p<span class="w"> </span>/home/user/persistent_data

<span class="c1"># Example Apptainer definition file to use persistent storage</span>
Bootstrap:<span class="w"> </span>library
From:<span class="w"> </span>ubuntu:20.04

%post
<span class="w">    </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nano
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello from Apptainer!&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/data/hello.txt

%runscript
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Modifying the data file...&quot;</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Another line added to the file.&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/data/hello.txt
<span class="w">    </span>cat<span class="w"> </span>/data/hello.txt
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the container that interacts with persistent data</span>
apptainer<span class="w"> </span>build<span class="w"> </span>data_container.sif<span class="w"> </span>data.def
</pre></div>
</div>
<p>This block builds the <code class="docutils literal notranslate"><span class="pre">data_container.sif</span></code> from the <code class="docutils literal notranslate"><span class="pre">data.def</span></code> file, which includes a simple script to modify and display a data file stored in <code class="docutils literal notranslate"><span class="pre">/data</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the container with the persistent storage directory bound</span>
apptainer<span class="w"> </span>run<span class="w"> </span>--bind<span class="w"> </span>/home/user/persistent_data:/data<span class="w"> </span>data_container.sif
</pre></div>
</div>
<p>This command mounts the <code class="docutils literal notranslate"><span class="pre">/home/user/persistent_data</span></code> directory from the host to the <code class="docutils literal notranslate"><span class="pre">/data</span></code> directory inside the container. This setup allows the container to read from and write to the persistent storage, ensuring that changes to the data file are maintained even after the container is stopped.</p>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading"></a></h2>
<p>In this tutorial, you’ve learned how to configure and use persistent storage with an Apptainer container. This practice is critical for applications that require data continuity, ensuring that valuable research data is not lost across container runs. By leveraging persistent storage, you can enhance the robustness and reliability of your containerized applications within the HPC environment.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>