<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reproducibility with Python &mdash; Container on HPC with Apptainer  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="../_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_rtd_theme_ext_color_contrast.css" />
      <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />

  
    <link rel="shortcut icon" href="../_static/coderefinery.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/minipres.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex/" />
    <link rel="search" title="Search" href="../search/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../" class="icon icon-home">
            Container on HPC with Apptainer
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">The lesson</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro_and_motivation/">Intro to containers (on HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basics_running_containers/">Basics of running containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../container_images/">Intro to container images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../building_images/">Building Apptainer images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binding_folders/">Binding folders into your container</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gpus/">Running containers that use GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../services_apps/">Services and apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tips_tricks/">Tips, tricks and frequently asked questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Exercises</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../verify_installation/">Verify Apptainer Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../first_build/">Building Your First Container</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Container on HPC with Apptainer</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Reproducibility with Python</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/coderefinery/ttt4hpc_containers/blob/main/ttt4hpc_containers/content/conda.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="reproducibility-with-python">
<h1>Reproducibility with Python<a class="headerlink" href="#reproducibility-with-python" title="Permalink to this heading"></a></h1>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand the role of Conda environments in ensuring reproducibility in scientific computing.</p></li>
<li><p>Learn how to set up a Conda environment within an Apptainer container.</p></li>
<li><p>Develop skills to create and manage Python environments that are consistent across various computing platforms.</p></li>
</ul>
<p>This demo demonstrates the creation of a Conda environment within an Apptainer container to enhance reproducibility in scientific computing. Conda is a popular package management system that simplifies package installation and environment management. This is crucial in scientific research where experiments often require specific versions of software and libraries to ensure consistent results.</p>
</div>
<div class="admonition-prerequisites prerequisites admonition" id="prerequisites-0">
<p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p>Access to an HPC system with Apptainer installed.</p></li>
<li><p>Basic knowledge of Python, Conda, and container technologies.</p></li>
</ul>
</div>
<p>Reproducibility is a cornerstone of scientific research, ensuring that results are consistent over time and across different platforms. By using Conda within Apptainer containers, researchers can encapsulate their computational environment, making their workflows portable and reproducible.</p>
<p>First, we’ll define a container with a Conda environment set up for a typical scientific Python stack.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example Apptainer definition file for setting up a Conda environment</span>
Bootstrap:<span class="w"> </span>library
From:<span class="w"> </span>continuumio/miniconda3

%post
<span class="w">    </span>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>scienv<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8<span class="w"> </span>numpy<span class="w"> </span>scipy<span class="w"> </span>matplotlib<span class="w"> </span>ipython<span class="w"> </span>-y
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;source activate scienv&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc

%environment
<span class="w">    </span><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/opt/conda/envs/scienv/bin:<span class="nv">$PATH</span>

%runscript
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Activating Conda environment and launching IPython...&quot;</span>
<span class="w">    </span><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>scienv
<span class="w">    </span>ipython
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build the container that includes the Conda environment</span>
apptainer<span class="w"> </span>build<span class="w"> </span>conda_container.sif<span class="w"> </span>conda.def
</pre></div>
</div>
<p>This block builds the <code class="docutils literal notranslate"><span class="pre">conda_container.sif</span></code> from the <code class="docutils literal notranslate"><span class="pre">conda.def</span></code> definition file, which uses the Miniconda image to install a Conda environment named <code class="docutils literal notranslate"><span class="pre">scienv</span></code> with several essential scientific computing packages like NumPy, SciPy, and Matplotlib.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the container, initiating the Conda environment</span>
apptainer<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>conda_container.sif<span class="w"> </span>/bin/bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;source ~/.bashrc &amp;&amp; ipython&quot;</span>
</pre></div>
</div>
<p>This command starts a shell that activates the Conda environment and launches IPython, a powerful interactive shell for Python. This setup allows users to interactively compute and visualize data within the consistent environment provided by the container.</p>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading"></a></h2>
<p>In this tutorial, you’ve learned how to create a reproducible Python computing environment using Conda within an Apptainer container. This approach is invaluable for scientific researchers who need to ensure that their computational experiments are consistent and reproducible, regardless of the underlying hardware or software environment. By leveraging Conda and Apptainer, you can significantly enhance the portability and reliability of your scientific workflows.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024-, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>